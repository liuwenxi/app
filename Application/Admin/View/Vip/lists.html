<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <!--[if lt IE 9]>
      <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
	.num,.current,.next,.prev{border: 1px solid #ccc; padding: 5px 10px; border-radius: 5px; margin-right:5px;}
	.ml-20{margin-left:20px;}
    </style>
  </head>
  <body>
    <div class="container-fluid">
          <div class="container-fluid">
              <h2><span class="glyphicon glyphicon-user"></span>用户管理</h2>
    </div>

        <div class="navbar navbar-default" >
            <form action=""  class="navbar-form form-inline" method="post" >
               <!-- <div class="form-group">
                    <select name="state" class="form-control">
                        <option value="">全部用户</option>
                        <option value="1">手机号码用户</option>
                        <option value="2">微信用户</option>
                        <option value="3">QQ用户</option>
                        <option value="4">微博用户</option>
                    </select>
                </div>-->
                <div class="form-group">
                    <select name="auth" class="form-control">
                        <option value="">不限实名认证</option>
                        <option value="3">未实名认证用户</option>
                        <option value="1">已实名认证用户</option>
                        <option value="2">实名认证不通过</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="sex" class="form-control">
                        <option value="">不限性别</option>
                        <option value="2">男</option>
                        <option value="1">女</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="time" class="form-control">
                        <option value="">不限排序方式</option>
                        <option value="1">按创建时间正序</option>
                        <option value="2">按创建时间倒序</option>
                        <option value="3">按最后活跃时间正序</option>
                        <option value="4">按最后活跃时间倒序</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="credit" class="form-control">
                        <option value="">不限信用分排序</option>
                        <option value="1">按信用分正序</option>
                        <option value="2">按信用分倒序</option>
                    </select>
                </div>
                <button type="submit"  class="btn btn-primary"><i class="fa fa-search"></i> 筛选</button>
            </form>

            <form action="" method="POST" style="float: right;margin-right: 50px">
                <input type="text" name="keyword" value="" placeholder="用户名称或者ID" class="input-sm">
                <button type="submit" class="btn btn-success" style="margin-left:10px;">搜索</button>
            </form>

            <form action="" method="" style="float: right;margin-right: 50px;">
                <a href="" class="btn btn-danger" style="margin-right: 10px;">发送站内消息</a>
                <a href="" class="btn btn-success">发送短信</a>
            </form>


            <form action=""  method="POST" style="float:left;">
                <div class="form-group" style="float:left;">
                    <div class="input-group">
                        <b>按创建时间：</b>
                        <input type="text" name="reg_time"  placeholder="创建时间段"  id="reg_time" class="input-sm">
                        <button type="submit" class="btn btn-success" style="margin-left:10px;">查询</button>
                    </div>
                </div>
            </form>

            <form action=""  method="POST" style="float:left;">
                <div class="form-group" style="float:left;margin-left: 100px">
                    <div class="input-group">
                        <b>按活跃时间：</b>
                        <input type="text" name="last_time"  placeholder="活跃时间段"  id="active_time" class="input-sm">
                        <button type="submit" class="btn btn-success" style="margin-left:10px;">查询</button>
                    </div>
                </div>
            </form>

        </div>


        <div class="panel-body">
            <table class="table table-bordered table-striped table-condensed">
                <thead>
                <tr>
                    <th>编号</th>
                    <th>头像</th>
                    <th>用户名</th>
                    <th>性别</th>
                    <th>等级</th>
                    <th>信用分</th>
                    <th>手机号</th>
                    <th>微信名称</th>
                    <th>QQ名称</th>
                    <th>微博名称</th>
                    <th>账户心愿豆</th>
                    <th class="numeric">创建时间</th>
                    <th class="numeric">最近活跃时间</th>
                    <th class="numeric">近15天访问次数</th>
                    <th class="numeric">近30天访问次数</th>
                    <th class="numeric">是否实名</th>
                    <th class="numeric">被举报次数</th>
                    <th class="numeric">操作</th>
                </tr>
                </thead>
                <tbody>
                <volist name="list" id="vo">   
                <tr>
                    <td style="text-align: center">{$vo.id}</td>
                    <td style="text-align: center"><img width="50px" src="{$vo.avatar}" alt=""></td>
                    <td style="text-align: center"><a>{$vo.nickname}</a></td>
                    <td style="text-align: center"><if condition="$vo.gender eq 1">女<else />男</if></td>
                    <td style="text-align: center">{$vo.level}</td>
                    <td style="text-align: center">{$vo.credit}</td>
                    <td style="text-align: center">{$vo.phone}</td>
                    <td style="text-align: center">{$vo.wechat_nickname}</td>
                    <td style="text-align: center">{$vo.QQ}</td>
                    <td style="text-align: center">{$vo.microblog}</td>
                    <td style="text-align: center">{$vo.totalmon}</td>
                    <td style="text-align: center">{$vo.reg_time|date="Y-m-d H:i:s",###}</td>
                    <td style="text-align: center">{$vo.last_time|date="Y-m-d H:i:s",###}</td>
                    <td style="text-align: center"></td>
                    <td style="text-align: center"></td>
                    <td class="numeric">
                        <if condition="$vo.is_auth eq 0">未完成
                            <elseif condition="$vo.is_auth eq 1"/>已完成
                            <elseif condition="$vo.is_auth eq 3"/>审核中
                            <elseif condition="$vo.is_auth eq 4"/>未通过
                        </if></td>
                    <td style="text-align: center">{$vo.be_report}</td>
                    <td class="numeric" data-id="{$vo.id}">
                        <a href="{:U('Vip/details?id='.$vo['id'])}">
                            <span class="glyphicon glyphicon-edit pointers padd-20 edit"></span>
                        </a>
                        <span class="glyphicon glyphicon-trash btn del"></span>
                        <a class="bg-sub tag margin-right float-right"
                           href="{:U('Vip/give?id='.$vo['id'])}"
                           class="tag margin-right float-right">赠送心愿豆</a>
                    </td>
                </tr>
                 </volist>
                </tbody>
            </table>
        </div>
        <div class="panel-footer">{$page}</div>
    </div>

   <!-- js -->
   <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
   <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script src="__PUBLIC__/Admin/layer/layer.js"></script>
    <script>
     $(".del").click(function(){
            var delid = $(this).parent().attr('data-id');
            layer.confirm('您确定要删除该数据吗？', {
                btn: ['是的','按错'] //按钮
            }, function(){
                //选择 是的
                $.ajax({
                    type:'post',
                    url:'{:U("Vip/del")}',
                    data:{id:delid},
                    dataType:'json',
                    success:function(data) {  
                        if(data === 1 ){  
                            layer.msg('删除成功', {shift: 6});
                            window.location.reload();  //刷新当前页
                        }else{  
                            layer.msg('删除失败'); 
                        }  
                    }
                });
            }, function(){
                //选择 按错 不执行
            });
        });
    </script>

    <link href="__PUBLIC__/Admin/Js/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />
    <script src="__PUBLIC__/Admin/Js/daterangepicker/moment.min.js" ></script>
    <script src="__PUBLIC__/Admin/Js/daterangepicker/daterangepicker.js"></script>
    <script src="__PUBLIC__/Admin/Css/bootstrap.min.css"></script>
    <script>
        $(document).ready(function(){
            ajax_get_table('search-form2',1);
            $('#reg_time').daterangepicker({
                format:"YYYY/MM/DD",
                singleDatePicker: false,
                showDropdowns: true,
                minDate:'2017/01/01',
                maxDate:'2030/01/01',
                startDate:'2017/01/01',
                locale : {
                    applyLabel : '确定',
                    cancelLabel : '取消',
                    fromLabel : '起始时间',
                    toLabel : '结束时间',
                    customRangeLabel : '自定义',
                    daysOfWeek : [ '日', '一', '二', '三', '四', '五', '六' ],
                    monthNames : [ '一月', '二月', '三月', '四月', '五月', '六月','七月', '八月', '九月', '十月', '十一月', '十二月' ],
                    firstDay : 1
                }
            });
        });

        $(document).ready(function(){
            ajax_get_table('search-form2',1);
            $('#active_time').daterangepicker({
                format:"YYYY/MM/DD",
                singleDatePicker: false,
                showDropdowns: true,
                minDate:'2017/01/01',
                maxDate:'2030/01/01',
                startDate:'2017/01/01',
                locale : {
                    applyLabel : '确定',
                    cancelLabel : '取消',
                    fromLabel : '起始时间',
                    toLabel : '结束时间',
                    customRangeLabel : '自定义',
                    daysOfWeek : [ '日', '一', '二', '三', '四', '五', '六' ],
                    monthNames : [ '一月', '二月', '三月', '四月', '五月', '六月','七月', '八月', '九月', '十月', '十一月', '十二月' ],
                    firstDay : 1
                }
            });
        });

        // ajax 抓取页面
        function ajax_get_table(tab,page){
            cur_page = page; //当前页面 保存为全局变量
            $.ajax({
                type : "POST",
                url:"/index.php/Admin/withdrawals/ajaxindex/p/"+page,//+tab,
                data : $('#'+tab).serialize(),// 你的formid
                success: function(data){
                    $("#ajax_return").html('');
                    $("#ajax_return").append(data);
                }
            });
        }

        // 点击排序
        function sort(field)
        {
            $("input[name='order_by']").val(field);
            var v = $("input[name='sort']").val() == 'desc' ? 'asc' : 'desc';
            $("input[name='sort']").val(v);
            ajax_get_table('search-form2',cur_page);
        }
    </script>

  </body>
</html>